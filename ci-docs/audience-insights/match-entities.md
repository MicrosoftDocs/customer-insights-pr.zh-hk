---
title: 比對資料統整的實體
description: 比對實體以建立統整的客戶設定檔。
ms.date: 01/28/2022
ms.service: customer-insights
ms.subservice: audience-insights
ms.topic: tutorial
author: adkuppa
ms.author: adkuppa
ms.reviewer: mhart
manager: shellyha
searchScope:
  - ci-match
---

# <a name="match-entities"></a>比對實體

比對階段指定如何將您的資料集結合至統整的客戶設定檔資料集。 在完成資料整合過程中的[對應](map-entities.md)步驟後，已準備好進行比對實體。 比對階段需要至少兩個已比對的實體。

比對頁面由三個部分組成： 
- 摘要比對記錄數量的關鍵計量
- 跨實體比對的比對順序和規則
- 比對實體的重複資料刪除規則

## <a name="specify-the-match-order"></a>指定比對順序

移至 **資料** > **統整** > **比對**，然後選取 **設定順序**，開始比對階段。

每次比對將兩個或多個實體整合為一個合併實體。 同時，它會保留唯一的客戶記錄。 例如，我們選擇了兩個實體：**eCommerce:eCommerceContacts** 作為主要實體，**LoyaltyScheme:loyCustomers** 作為第二實體。 實體順序表示系統嘗試比對記錄的順序。

:::image type="content" source="media/match-page.png" alt-text="比對頁面的資料整合過程中統一區域的螢幕擷取畫面。":::
  
主要實體 *eCommerce:eCommerceContacts* 與下一個實體 *LoyaltyScheme:loyCustomers* 相符。 如果您擁有超過兩個實體，則第一個比對步驟產生的資料集將與下列實體比對。

> [!IMPORTANT]
> 您選擇作為主要實體的實體將用作整合個人資料資料集的基礎。 在比對階段期間選取的其他實體將會新增至此實體中。 這並不代表著整合實體將包含此實體中包含的 *所有* 資料。
>
> 有兩個考慮可以協助您選擇實體的階層：
>
> - 請選擇擁有客戶最完整、最可靠的個人資料的實體來作為主要實體。
> - 選擇與其他實體有多個共同屬性 (例如姓名、電話號碼或電子郵寄地址) 的實體作為主要實體。

在指定比對順序後，您將在 **資料** > **整合** > **比對** 的 **比對記錄詳細資訊** 區段看到定義好的比對組。 到比對過程完成前，關鍵計量將維持空白。

## <a name="define-rules-for-match-pairs"></a>定義比對組的規則

比對規則指定將與特定實體配對進行比對的邏輯。

實體名稱旁邊的 **需要規則** 警告表示對比對組沒有定義比對規則。 

:::image type="content" source="media/match-rule-add.png" alt-text="比對記錄詳細資訊區段的螢幕擷取畫面，畫面上有醒目提示新增規則的控制項。":::

1. 在 **比對記錄詳細資訊** 區段的實體下選擇 **新增規則**，定義比對規則。

1. 在 **建立規則** 的窗格中，設定規則的條件。

   :::image type="content" source="media/match-rule-conditions.png" alt-text="已新增條件，比對規則開啟的螢幕擷取畫面。":::

   - **實體/欄位 (第一列)**：選擇相關實體和屬性以指定有可能唯一的客戶記錄屬性。 例如，電話號碼或電子郵寄地址。 避免以活動類型屬性進行比對。 例如，購買識別碼可能會在其他記錄類型中找不到符合項目。

   - **實體/欄位 (第二列)**：選擇與第一列中指定的實體屬性相關的屬性。

   - **正規化**：為選取的屬性從以下正規化選項中進行選擇。 
     - 空格：刪除所有空白。 *Hello   World* 變成 *HelloWorld*。
     - 符號：刪除所有符號和特殊字元。 *Head&Shoulder* 變成 *HeadShoulder*。
     - 文字為小寫：將所有字元轉換為小寫。 *ALL CAPS and Title Case* 變成 *all caps and title case*。
     - Unicode 到 ASCII：將 Unicode 轉換為 ASCII 字元。 */u00B2* 變成 *2*。
     - 數字：將其他數字系統 (如羅馬數字) 轉換為阿拉伯數位。 *VIII* 變成 *8*。
     - 語義類型：標準化姓名、標題、電話號碼、地址等等。 

   - **精度**：設定適用此條件的精準度等級。 
     - **基本**：從 *低*、*中*、*高* 與 *完全相符* 進行選擇。 選取 **完全相符** 以只比對符合 100% 的記錄。 選取其中一個其他等級，以比對不是 100% 相同的記錄。
     - **自訂**：設定記錄需要相符的百分比。 系統將只比對超過此閾值的記錄。

1. 提供規則的 **名稱**。

1. [新增更多條件](#add-conditions-to-a-rule)或選擇 **完成** 確定最終規則。

1. 或者，[新增更多規則](#add-rules-to-a-match-pair)。

1. 選取 **儲存** 套用變更。

### <a name="add-conditions-to-a-rule"></a>對規則新增條件

僅在屬性滿足多個條件時比對實體，對比對規則新增更多條件。 條件以邏輯運算子 AND 相連接，只有在滿足所有條件的情況下才會執行。

1. 移至 **資料** > **整合** > **比對**，並對要新增條件的規則選擇 **編輯**。

1. 在 **編輯規則** 窗格中，選取 **新增條件**。

1. 選取 **完成** 以儲存規則。

### <a name="add-rules-to-a-match-pair"></a>將規則新增到比對組中

比對規則代表條件組。 要以用到多個屬性的條件來比對實體，新增更多規則

1.  移至 **資料** > **整合** > **比對**，並對要新增規則的實體選擇 **新增規則**。

2. 遵循[對比對組訂定規則中的 ](#define-rules-for-match-pairs)步驟。

> [!NOTE]
> 規則的順序很重要。 比對演算法會嘗試根據您的第一個規則進行比對，並且只有在第一個規則沒有相符的時後繼續進行第二個規則。

### <a name="change-the-entity-order-in-match-rules"></a>變更比對規則中的實體順序

您可以重新排序比對規則的實體，來變更它們的處理順序。 由於變更順序導致衝突的規則將會被移除。 您必須用更新設定重新建立被移除的規則。

1. 移至 **資料** > **統整** > **比對** 並選取 **編輯**。

1. 在 **編輯規則** 窗格中，選取 **上移/下移** 控制項，或拖放實體以變更順序。

   :::image type="content" source="media/reorder-match-rules.png" alt-text="變更在 比對階段處理實體順序的選項。":::

1. 選取 **完成** 以儲存規則。

## <a name="define-deduplication-on-a-match-entity"></a>請在比對實體上定義重複資料刪除

除了[跨實體比對規則](#define-rules-for-match-pairs)外，您還可以指定重複資料刪除規則。 *重複資料刪除* 是比對記錄時的另一個過程。 它會找出重複的記錄並將其合併到一個記錄中。 來源記錄被連結到具備備用識別碼的合併後記錄。

重複資料刪除的記錄將用在跨實體比對流程。 重複資料刪除發生在單個實體上，可以對比對組使用的每個實體設定。

指定重複資料刪除規則並非必要動作。 如果未組態此類規則，會套用系統定義的規則。 他們將所有記錄合併到單個記錄中，再將實體數據傳遞給跨實體比對，以此增強效能。

### <a name="add-deduplication-rules"></a>新增重複資料刪除規則

1. 請前往 **資料** > **統整** > **比對**。

1. 在 **重複資料刪除記錄詳細資料** 區段中，選取 **設定實體**。 如果已經建立重複資料刪除規則，請選擇 **編輯**。

1. 請在 **合併偏好** 窗格中選取您要執行重複資料刪除規則的實體。

   1. 指定合併重複資料記錄的方式並從三個選項中選擇一個：
      - **最多填滿**：找出填滿最多屬性的記錄作為勝出記錄。 這是預設合併選項。
      - **最新**：根據最新情況找出贏家記錄。 需要日期或數字欄位來定義最新。
      - **時間最接近**：以新近度最接近的，找出入選方記錄。 需要日期或數字欄位來定義新近度。

   1. 或者，選取 **進階** 來定義實體個別屬性的重複資料刪除規則。 例如，您可以選擇保留最近的電子郵件，「及」來自不同記錄的最完整地址。 展開實體以查看其所有屬性，並定義要用於個別屬性的選項。 如果您選擇基於新近度的選項，也需要指定定義新近度的日期/時間欄位。 
 
      > [!div class="mx-imgBorder"]
      > ![重複資料刪除規則步驟 1。](media/match-selfconflation.png "重複資料刪除規則步驟 1")

   1. 選取 **完成**，以套用重複資料刪除的合併喜好設定。
 
1. 當選取實體並設定其合併喜好設定後，請選取 **新增規則**，定義實體層級上的重複資料刪除規則。
   - **選擇欄位** 列出該實體的所有可用欄位。 選擇要檢查重複的欄位。 選擇對每個客戶很可能是唯一的欄位。 例如，電子郵件地址，或姓名、城市和電話號碼的組合。
   - 指定正規化和精確度設定。
   - 您可以選取 **新增條件** 定義更多條件。
 
   > [!div class="mx-imgBorder"]
   > ![重複資料刪除規則步驟 2。](media/match-selfconflation-rules.png "重複資料刪除規則步驟 2")

  您可以為某實體建立多個重複資料刪除規則。 

1. 現在執行比對流程會根據重複資料消除規則中定義的條件分組記錄。 記錄分組之後就會套用合併規則找出贏家記錄。

1. 然後，此勝出記錄會傳遞至交叉實體比對，同時也會傳遞非勝出記錄 (例如，替代識別碼)，以改善比對品質。

1. 定義好的任何自訂的比對規則都會覆寫重複資料刪除規則。 若重複資料刪除規則找出比對記錄，且自訂比對規則設定為永不比對那些記錄，則此兩筆記錄將無法被比對。

1. 執行[比對程序](#run-the-match-process)之後，您會在重要計量圖格中看到重複資料刪除統計。

### <a name="deduplication-output-as-an-entity"></a>將重複資料刪除輸出成實體

重複資料刪除過程為比對組中的每個實體建立一個新實體，以找出刪除重複的記錄。 這些實體與 **ConflationMatchPairs:CustomerInsights** 在 **實體** 頁面的 **系統** 區段中，名稱為 **Deduplication_DataSource_Entity**。

重複資料刪除輸出實體包含下列資訊：
- 識別碼/金鑰
  - 主索引鍵欄位及其替代識別碼欄位。 替代識別碼欄位是由被辨識為記錄的替代識別碼所組成。
  - 根據指定的重複資料刪除欄位，Deduplication_GroupId 欄位顯示實體中辨識出的群組或叢集，裡面都是類似記錄。 為系統處理的需求而被使用。 如果未指定手動重複資料刪除規則，並套用系統定義的重複資料刪除規則，您就不會在重複資料刪除輸出實體中找到此欄位。
  - Deduplication_WinnerId：此欄位包含的勝出識別碼來自於已辨識的群組或叢集。 如果 Deduplication_WinnerId 與記錄的主索引鍵相同，則表示該記錄是勝出的記錄。
- 用來定義重複資料刪除規則的欄位。
- 規則和分數欄位，表示所套用的重複資料刪除規則和比對演算法回傳的分數。
   
## <a name="run-the-match-process"></a>執行比對程序

設定好比對規則，包括跨實體比對和重複資料刪除規則後，您可以執行比對程序。 

前往 **資料** > **整合** > **比對** 並選擇 **執行** 啟動程序。 比對演算法需要一些時間來完成，執行完成前您無法更改設定。 若要變更，您可以取消執行： 選擇工作的狀態，並在 **程序詳細資訊** 窗格上選擇 **取消工作**。

在 **實體** 頁面上，您將找到成功執行的結果(整合的客戶個人資料實體)。 在 **個人資料** 區段，您的整合客戶實體名稱為 **客戶**。 第一次成功的比對執行建立了整合 *客戶* 實體。 後續所有比對執行都會擴充該實體。

[!INCLUDE [progress-details-include](../includes/progress-details-pane.md)]

## <a name="review-and-validate-your-matches"></a>檢閱和驗證您的比對

前往 **資料** > **整合** > **比對**，評估比對組的品質，必要時對進行修改。

頁面頂部的圖格顯示關鍵計量，摘要相符的記錄和重複。

:::image type="content" source="media/match-KPIs.png" alt-text="比對頁面上關鍵計量的螢幕擷取畫面 (已裁剪)，畫面上有數字和詳細資訊。":::

- **唯一來源記錄** 顯示上次比對執行處理的個別來源記錄的數量。
- **比對和未比對的記錄** 醒目提示比對規則處理後保留多少唯一記錄。
- **僅限相符的記錄** 顯示所有比對組的相符數量。

您可以在 **相符記錄詳細資料** 表中評估每個比對組的結果及其規則。 比較來自一組比對組對的記錄數量與成功相符記錄的百分比。

檢閱比對組的規則，在規則等級查看成功相符記錄的百分比。 選擇省略符號 (...)，然後選擇 **比對預覽**，在規則等級上查看這些全部記錄。 我們建議您查看一些記錄，以驗證它們是否正確比對。

在條件上嘗試不同的精度度閾值來找到最佳值。

  1. 選擇要試驗的規則其省略符號 (...)，並選擇 **編輯**。

  2. 在您要修訂的條件中，調整精準度的值。

  3. 選擇 **預覽**，查看選擇的條件的相符和不相符的記錄數量。

## <a name="manage-match-rules"></a>管理比對規則

您可以重新設定和微調大部分的比對參數。

:::image type="content" source="media/match-rules-management.png" alt-text="螢幕擷取畫面，圖上為有比對規則選項的下拉式功能表。":::

- **變更您的規則順序**：若您定義了多個規則。 您可以通過選擇 **向上移動** 和 **向下移動** 選項或通過拖放來重新排序比對規則。

- 藉由選擇 **編輯** 和選擇不同的欄位來 **變更規則條件**。

- **停用規則**，從比對程序排除規則時，保留比對規則。

- **複製您的規則**，如果你已經定義了比對規則，並希望以修改建立類似的規則，選擇 **複製**。

- 選擇 **刪除** 符號 **刪除規則**。

## <a name="advanced-options"></a>進階選項

### <a name="add-exceptions-to-a-rule"></a>將例外新增至規則

在大多數狀況中，實體比對會以整合資料產生獨特使用者個人資料。 若要動態處理誤判和漏判的罕見案例，您可以為比對規則定義例外。 例外是在執行比對規則之後套用，且避免比對所有符合例外準則的記錄。

例如，如果比對規則結合姓氏、市/鎮及出生日期，系統會判斷居住在同一市/鎮，有著相同姓氏的雙胞胎為相同個人資料。 您可以指定例外是：如果組合實體中的名字不相同，則個人資料不相符。

1. 移至 **資料** > **整合** > **比對**，並對要新增條件的規則選擇 **編輯**。

1. 在 **編輯規則** 窗格中，選取 **新增例外**。

1. 指定例外準則。 

1. 選取 **完成** 以儲存規則。

### <a name="specify-custom-match-conditions"></a>指定自訂比對條件

您可以指定會覆寫預設比對邏輯的條件。 有四個可用的選項： 

|選項  |Description |範例  |
|---------|---------|---------|
|永遠比對     | 定義永遠要比對的值。         |  永遠比對 *Mike* 和 *MikeR*。       |
|永不比對     | 定義永遠不比對的值。        | 永遠不比對 *John* 和 *Jonathan*。        |
|自訂略過     | 定義系統在比對階段應永遠忽略的值。 |  在比對時忽略值 *11111* 和 *Unknown*。        |
|別名對應    | 定義系統應考慮為相同值的值。         | 考慮 *Joe* 等於 *Joseph*。        |

1. 前往 **資料** > **整合** > **比對**，並在 **相符記錄詳細資訊** 區段中選擇 **自訂比對**。

   :::image type="content" source="media/custom-match-create.png" alt-text="比對規則區段的螢幕擷取畫面，畫面上有醒目提示自訂比對的控制項。":::

1. 在 **自訂** 窗格中，移至 **記錄** 索引標籤。

1. 從 **自訂類型** 下拉式功能表中選擇自訂比對選項，然後選取 **下載範本**。 每個比對選項需要不同的範本。

1. 請打開下載的範本檔案，並填入詳細資料。 範本包含欄位，指定實體以及要在自訂比對中使用的實體主索引鍵值。 例如，如果您希望 *銷售* 實體的主索引鍵 *12345* 永遠與 *連絡人* 實體的主索引鍵 *34567* 相符，請寫入範本：
    - Entity1：銷售
    - Entity1Key：12345
    - Entity2：連絡人
    - Entity2Key：34567

   相同的範本檔案可以指定來自多個實體的自訂比對記錄。
   
   如果您想要在實體上指定重複資料刪除的自訂比對，請提供相同的實體當作 Entity1 和 Entity2 ，並設定不同主索引鍵值。

1. 新增所有覆寫之後，儲存範本檔案。

1. 前往 **資料** > **資料來源** 並將範本檔案內嵌為新實體。

1. 在上傳檔案且實體可用之後，請再次選取 **自訂比對** 選項。 您會看到選項，以指定您想要加入的實體。 從下拉式功能表選取必要的實體，然後選取 **完成**。

   :::image type="content" source="media/custom-match-overrides.png" alt-text="螢幕擷取畫面上為選擇覆寫自訂比對案例的對話方塊。":::

1. 套用自訂比對時，會根據您要使用的比對選項而定。 

   - 對於 **永遠比對** 或 **永不比對**，繼續進行下一步。
   - 對於 **自訂略過** 或 **別名對應**，請在現有的比對規則上選取 **編輯** 或建立新規則。 在 [正規化] 下拉式功能表中，選擇 **自訂略過** 或 **別名對應** 選項，然後選取 **完成**。

1. 在 **比對** 頁面上選擇 **儲存**"套用自訂比對設定。

1. 在 **比對** 頁面上選擇 **執行** 啟動比對程序。 其他指定的比對規則被自訂比對設定覆寫。

#### <a name="known-issues"></a>已知問題

- 自我合併並不會顯示重複資料刪除實體中的正規化資料。 但是，在重複資料刪除期間，它會套用正規化。 這是所有正規化的設計。 
- 當比對規則使用別名對應或自訂略過時，如果在 **對應** 階段中移除語義類型設定，就不會套用正規化。 只有在設定比對規則中的正規化後清除語義類型，才會發生這種情況，因為語義類型將會未知。


## <a name="next-step"></a>下一個步驟

在完成至少一個比對組的比對程序之後，請繼續執行 [**合併**](merge-entities.md)步驟。


[!INCLUDE[footer-include](../includes/footer-banner.md)]

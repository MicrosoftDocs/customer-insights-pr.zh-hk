---
title: 將實體合併到資料統整中
description: 合併實體以建立統整的客戶設定檔。
ms.date: 01/28/2022
ms.service: customer-insights
ms.subservice: audience-insights
ms.topic: tutorial
author: adkuppa
ms.author: adkuppa
ms.reviewer: mhart
manager: shellyha
searchScope:
  - ci-merge
---

# <a name="merge-entities"></a>合併實體

合併階段是資料統整程序的最後一個階段。 其目的在於協調衝突的資料。 衝突資料的範例包括位於兩個資料集中的客戶名稱，但在各資料集中略有不同 (例如「Grant Marshall」與「Grant Marshal」)，或是格式不同的電話號碼 (617-803-091X 與 617803091X)。 合併這些相互衝突的資料點，是依屬性逐一進行。

:::image type="content" source="media/merge-fields-page.png" alt-text="資料統整處理中的合併頁面，顯示定義整合客戶個人資料且具有合併欄位的表格。":::

完成 [比對階段](match-entities.md)之後，您可以透過在 **統整** 頁面上選取 **合併** 圖標來開始合併階段。

## <a name="review-system-recommendations"></a>檢閱系統建議

在 **資料** > **統整** > **合併** 中，您可以選擇並排除一些屬性，不要合併到整合客戶個人資料實體中。 整合客戶個人資料是資料統整處理的結果。 某些屬性會由系統自動合併。

若要查看包含在自動合併屬性中的任一種屬性，請在表格的 **客戶欄位** 索引標籤中，選取該合併屬性。 構成該合併屬性的屬性會顯示在合併屬性下方的兩個新列中。

## <a name="separate-rename-exclude-and-edit-merged-fields"></a>分割、重新命名、排除及編輯合併欄位

您可以變更系統處理合併屬性的方式，生成整合客戶個人資料。 選取 **顯示詳細資訊**，然後選擇要變更的內容。

:::image type="content" source="media/manage-merged-attributes.png" alt-text="顯示更多的下拉式功能表中的選項，可管理合併屬性。":::

如需詳細資訊，請參閱下節。

## <a name="separate-merged-fields"></a>分割合併欄位

若要分割合併欄位，請在表格中尋找屬性。 分割欄位會以個別資料點顯示在整合的客戶個人資料上。 

1. 選取合併欄位。
  
1. 選取 **顯示更多**，然後選擇 **分割欄位**。
 
1. 確認分割。

1. 選取 **儲存** 並 **執行** 來處理變更。

## <a name="rename-merged-fields"></a>重新命名合併欄位

變更合併屬性的顯示名稱。 您無法變更輸出實體的名稱。

1. 選取合併欄位。
  
1. 選取 **顯示更多**，然後選擇 **重新命名**。

1. 確認變更顯示名稱。 

1. 選取 **儲存** 並 **執行** 來處理變更。

## <a name="exclude-merged-fields"></a>排除合併欄位

從整合的客戶個人資料中排除屬性。 如果欄位是用於其他程序中 (例如，客戶細分)，則請先從這些程序中移除該欄位，然後再從客戶個人資料中排除它。 

1. 選取合併的欄位。
  
1. 選取 **顯示更多**，然後選擇 **排除**。

1. 確認排除。

1. 選取 **儲存** 並 **執行** 來處理變更。 

在 **合併** 頁面上，選取 **排除欄位** 以查看所有排除欄位的清單。 此窗格可新增排除欄位。

## <a name="edit-a-merged-field"></a>編輯合併的欄位

1.  選取合併的欄位。

1.  選取 **顯示更多**，然後選擇 **編輯**。

1.  指定如何以三個選項中之一將欄位結合或合併：
    - **重要**：根據指定給參與欄位的重要性等級，找出勝出值。 這是預設合併選項。 選取 **上移/下移** 來設定重要性等級。
    :::image type="content" source="media/importance-merge-option.png" alt-text="合併欄位對話方塊中的重要性選項。"::: 
    - **最新**：根據新近度來找出勝出值。 要定義新近度，在合併欄位範圍中，每個參與的實體都需要一個日期或數字欄位。
    :::image type="content" source="media/recency-merge-option.png" alt-text="合併欄位對話方塊中的新近度選項。":::
    - **最低新近度**：根據最低的新近度來找出勝出值。 要定義新近度，在合併欄位範圍中，每個參與的實體都需要一個日期或數字欄位。

1.  您可以新增更多欄位參加合併程式。

1.  您可以重新命名合併欄位。

1. 選取 **完成** 套用變更。

1. 選取 **儲存** 並 **執行** 來處理變更。 

## <a name="combine-fields-manually"></a>手動合併欄位

手動指定合併屬性。

1. 在 **合併** 頁面上，選取 **合併**。

1. 選擇 **欄位** 選項。

1. 在 **以...合併欄位** 中，以下拉式清單指定合併入選方原則。

1. 選擇欄位以新增。 選擇 **新增欄位** 結合更多欄位。

1. 提供 **名稱** 和 **輸出欄位名稱**。

1. 選取 **完成** 套用變更。

1. 選取 **儲存** 並 **執行** 來處理變更。 

## <a name="combine-a-group-of-fields"></a>合併一組欄位群組

將一組欄位當作單一單位處理。 例如，當我們的記錄包含欄位地址 1、地址 2、市/鎮、州/省和郵遞區號時。 想要讓我們的資料變得更加完整，我們可能不想要合併不同記錄的地址 2

1. 在 **合併** 頁面上，選取 **合併**。

1. 選擇 **欄位群組** 選項。

1. 在 **以...排名群組** 中，以下拉式清單指定合併入選方原則。

1. 如果您要新增其他欄位或其他群組到欄位，請選取 **新增** 並選擇。

1. 提供每個合併欄位的 **名稱** 和 **輸出名稱**。

1. 提供群組欄位的 **名稱**。 

1. 選取 **完成** 套用變更。

1. 選取 **儲存** 並 **執行** 來處理變更。

## <a name="change-the-order-of-fields"></a>變更欄位順序

某些實體比其他實體包含更多詳細資料。 如果實體包含欄位的最新資料，您可以在合併值時，設定它優先於其他實體。

1. 選取合併欄位。
  
1. 選取 **顯示更多**，然後選擇 **編輯**。

1. 在 **合併欄位** 窗格中，選取 **上移/下移** 來設定順序，或將它們拖放至想要的位置。

1. 確認變更。

1. 選取 **儲存** 並 **執行** 來處理變更。

## <a name="configure-customer-id-generation"></a>設定客戶識別碼產生 

設定合併欄位之後，您可以定義如何生成 CustomerId 值，即唯一客戶個人資料識別碼。 資料整合程序中的合併步驟會生成唯一的客戶個人資料識別碼。 識別碼是客戶實體中的 *CustomerId*，是由資料整合程序所產生的。 

客戶實體中的 CustomerId 是用非 null 的勝出主索引鍵其第一個值雜湊得到。 這些索引鍵來自比對和合併階段中使用的實體，並受比對順序的影響。因此比對順序的主要實體中主索引鍵變更時，所生成的 CustomerID 會變更。 因此主鍵值可能不見得全代表相同客戶。

組態穩定的客戶識別碼能讓您避開那樣的行為。

**設定唯一客戶識別碼**

1. 移至 **整合** > **合併**。

1. 請選取 **金鑰** 索引標籤。 

1. 將滑鼠暫留在 **CustomerId** 列上，然後選取 **設定** 選項。
   :::image type="content" source="media/customize-stable-id.png" alt-text="識別碼生成的自訂控制項。":::

1. 最多選取五個欄位來構成唯一的客戶識別碼，而且更穩定。 不符合您設定的記錄，會使用系統設定的識別碼。  

1. 選取 **完成**，並執行合併程式以套用您的變更。

## <a name="group-profiles-into-households-or-clusters"></a>將設定檔以家戶或叢集單位分組

作為客戶設定檔產生組態程式的一環，您可以定義規則，將相關設定檔編入叢集組別。 目前有兩種可用的叢集類型–家戶叢集和自訂叢集。 如果 *客戶* 實體包含語義欄位 *Person. LastName* 和 *Location.Address*，系統會自動選擇已有預定義規則的家戶。 您也可以使用自己的規則和條件建立叢集，類似[相符規則](match-entities.md#define-rules-for-match-pairs)。

**定義家戶或叢集**

1. 移至 **整合** > **合併**。

1. 請在 **合併** 索引標籤上選取 **進階** > **建立叢集**。

   :::image type="content" source="media/create-cluster.png" alt-text="控制項建立新叢集。":::

1. 請在 **家戶** 或 **自訂** 叢集之間選擇。 如果 *客戶* 實體存在語義欄位 *Person.LastName* 和 *Location.Address*，會自動選取家戶。

1. 提供叢集名稱並選取 **完成**。

1. 請選取 **叢集** 索引標籤尋找您建立的叢集。

1. 指明規則和條件以定義您的叢集。

1. 請選取 **執行** 以執行合併程式和建立叢集。

執行合併程式後會將叢集識別碼新增為 *客戶* 實體的新欄位。

## <a name="run-your-merge"></a>執行合併

不論您手動合併屬性或讓系統合併，您都可以執行合併。 在 **合併** 頁面上，選取 **執行** 來開始處理。

> [!div class="mx-imgBorder"]
> ![資料合併儲存與執行。](media/configure-data-merge-save-run.png "資料合併儲存與執行")

若只想要查看反映在整合客戶實體中的輸出，請選取 **只執行合併**。 下游程序將會按照[排程中定義的重新整理](system.md#schedule-tab)來重新整理。

選擇 **執行合併及下游程序** 以變更來重新整理系統。 所有程序 (包括擴充、客戶細分和量值) 都會自動重新執行。 在所有下游程序完成後，客戶個人資料會反映出您做的所有變更。

若要進行更多變更並重新執行步驟，您可以取消進行中的合併。 選取 **重新整理中...**，然後在出現的側面窗格中選取 **取消工作**。

[!INCLUDE [progress-details-include](../includes/progress-details-pane.md)]

:::image type="content" source="media/process-detail-path.png" alt-text="從工作狀態連結取得程序詳細資料的逐層探究路徑。":::

## <a name="next-step"></a>後續步驟

設定[活動](activities.md)、[擴充](enrichment-hub.md)或[關聯](relationships.md)，以進一步了解您的客戶。

如果您已設定活動、擴充或客戶細分，則會自動處理它們，以使用最新的客戶資料。

[!INCLUDE[footer-include](../includes/footer-banner.md)]
